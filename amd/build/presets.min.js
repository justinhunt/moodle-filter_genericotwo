define("filter_genericotwo/presets",["jquery","core/log"],(function($,log){return log.debug("Filter GenericoTwo Presets initialising"),{presetdata:!1,dataitems:["version","templatekey","name","instructions","content","templateend","variabledefaults","jscontent","previewcontext","importcss","customcss","dataset","datasetvars","allowedcontexts","allowedcontextids"],fetchcontrols:function(){var controls={};return this.dataitems.forEach((function(item){controls[item]=document.getElementById("id_"+item)})),controls},fetchjsonbundle:function(controls){var bundle={};return this.dataitems.forEach((function(item){controls[item]&&(bundle[item]=controls[item].value)})),JSON.stringify(bundle)},exportbundle:function(){var controls=this.fetchcontrols();if(controls.templatekey&&""!=controls.templatekey.value)filename=controls.templatekey.value;else{var filename="preset";controls.name&&controls.name.value&&(filename=controls.name.value)}var jsonbundle=this.fetchjsonbundle(controls),pom=document.createElement("a");if(pom.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(jsonbundle)),pom.setAttribute("download",filename+".txt"),document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!0),pom.dispatchEvent(event)}else pom.click()},populateform:function(presetindex,presetdata){var controls=this.fetchcontrols();if(""!==presetindex&&null!==presetindex||presetdata){var selectedPreset=null;if(void 0!==presetdata&&presetdata)selectedPreset=presetdata[0];else{if(!this.presetdata)return;selectedPreset=this.presetdata[presetindex]}if(selectedPreset){this.dataitems.forEach((function(item){var value=null;if(selectedPreset.hasOwnProperty(item))value=selectedPreset[item];else switch(item){case"templatekey":selectedPreset.hasOwnProperty("key")&&(value=selectedPreset.key);break;case"content":selectedPreset.hasOwnProperty("body")&&(value=selectedPreset.body);break;case"templateend":selectedPreset.hasOwnProperty("bodyend")&&(value=selectedPreset.bodyend);break;case"importcss":selectedPreset.hasOwnProperty("requirecss")&&(value=selectedPreset.requirecss);break;case"customcss":selectedPreset.hasOwnProperty("style")&&(value=selectedPreset.style);break;case"jscontent":selectedPreset.hasOwnProperty("script")&&(value=selectedPreset.script);break;case"variabledefaults":selectedPreset.hasOwnProperty("defaults")&&(value=selectedPreset.defaults)}if(controls[item]&&null!==value)if(window.ace){$(controls[item]).val(value).trigger("change");var editorEnv=ace.edit($(controls[item]).prev()[0]);editorEnv&&editorEnv.setValue&&editorEnv.setValue(value,1)}else $(controls[item]).val(value)}))}}},dopopulate:function(templatedata){this.populateform(0,new Array(templatedata))},init:function(opts){if(!this.presetdata){var presetcontrol=$("#id_filter_genericotwo_presetdata").get(0);presetcontrol&&(this.presetdata=JSON.parse(presetcontrol.value))}var thismodule=this;$("#id_filter_genericotwo_presets").change((function(){thismodule.populateform($(this).val())}));var ddsquareid="#id_filter_genericotwo_dragdropsquare";$(ddsquareid).on("click",(function(){thismodule.exportbundle()})),$(ddsquareid).on("dragover",(function(event){event.preventDefault(),event.stopPropagation(),$(this).addClass("filter_genericotwo_dragging")})),$(ddsquareid).on("dragleave",(function(event){event.preventDefault(),event.stopPropagation(),$(this).removeClass("filter_genericotwo_dragging")})),$(ddsquareid).on("drop",(function(event){event.preventDefault();var files=event.originalEvent.dataTransfer.files;if(files.length){var f=files[0];if(f){var r=new FileReader;r.onload=function(e){var contents=e.target.result;try{var templatedata=JSON.parse(contents);(templatedata.key||templatedata.templatekey)&&thismodule.dopopulate(templatedata)}catch(e){alert("Invalid JSON file")}},r.readAsText(f)}}$(this).removeClass("filter_genericotwo_dragging")}))}}}));

//# sourceMappingURL=presets.min.js.map